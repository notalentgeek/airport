{% load djng_tags %}
{% load static %}

<nav class="navbar navbar-default">

  <!-- Header and burger button for mobile view. -->
  <div class="navbar-header">
    <a class="navbar-brand" href="#" id="title">airport management</a>
    <button aria-expanded="false" class="collapsed navbar-toggle"
      data-target="#main-menu" data-toggle="collapse" type="button">
      <span class="sr-only">toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
  </div>

  <!-- Main menu, mainly used for login, logout, and register. -->
  <div class="collapse navbar-collapse" id="main-menu">
    <div class="navbar-left">
      <ul class="nav navbar-nav" id="move-atc-menu-here-when-mobile"
        ng-controller="atc_menu">

        <li class="dropdown" id="hide-atc-menu-when-mobile">
          <a aria-expanded="false" aria-haspopup="true" class="dropdown-toggle"
            data-toggle="dropdown" href="#" role="button">
            atc<span class="caret"></span>
          </a>
          <ul class="dropdown-menu" id="move-atc-menu-here-when-not-mobile">
            {% if user.is_authenticated and not user.is_superuser %}
              <li id="atc-form-button-container">
                <a href="#" id="atc-form-button"
                  ng-click="show_atc_form_modal()">
                  atc form
                </a>
              </li>
            {% endif %}
            <li id="atc-list-button-container">
              <a href="#" id="atc-list-button" ng-click="show_atc_list_modal()">
                atcs list
              </a>
            </li>
          </ul>
        </li>

      </ul>
    </div>

    <div class="navbar-right">

      <!-- Login and register for the user (airport manager). -->
      {% if user.is_authenticated and not user.is_superuser %}
        <form action="{% url 'airport_management:logout_airport_manager' %}"
          class="navbar-form" id="logout-form" method="POST">
          {% csrf_token %}
          <div id="logout-form-button-container">
            <input class="btn btn-block btn-success" id="user-button"
              param="{{ user.username }}" type="submit"
              value="hello! {{ user.username }}" />
          </div>
        </form>
      {% else %}
        <form action="{% url 'airport_management:login_or_register_airport_manager' %}"
          class="navbar-form" id="login-register-form" method="POST"
          ng-controller="login_register_form">
          <div id="main-menu-container">
            {% csrf_token %}

            <!-- Form's text input. -->
            <div id="main-menu-form-input">
              <input class="form-control" id="username-input" type="text"
                name="username"
                param="{% url 'airport_management:check_user_existence' %}"
                placeholder="user name" ng-change="check_username_existence()"
                ng-model="username_input" />

              <!--
              Adding wrong password modal trigger with these codes. The
              template received error message from the Django server. The
              difference between the `if` and `else` is the attribute
              `param="{{ wrong_password }}"` which later triggered in nav.js.
              -->
              {% if messages %}
                {% for message in messages %}
                  {% with wrong_password=message %}
                    <input class="form-control" id="password-input"
                      type="password" name="password"
                      param="{{ wrong_password }}" placeholder="password" />
                  {% endwith %}
                {% endfor %}
              {% else %}
                <input class="form-control" id="password-input"
                  type="password" name="password" placeholder="password" />
              {% endif %}
            </div>

            <!-- Form's buttons. -->
            <div id="main-menu-form-buttons-container">
              <div class="main-menu-form-button">
                <input class="btn btn-block btn-success" name="submit-button"
                  type="submit" value="login" />
              </div>
              <div class="main-menu-form-button">
                <input class="btn btn-block btn-primary" id="register-button"
                  name="submit-button" type="submit" value="register"
                  ng-disabled="disable_register_button" />
              </div>
            </div>
          </div>
        </form>
      {% endif %}

    </div>
  </div>
</nav>

<!-- Modal page for a form to register ATC. -->
<div class="fade modal" id="atc-form-modal" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content. -->
    <form action="{% url 'airport_management:register_atc' %}"
      class="form-horizontal" id="atc-register-form" method="POST"
      name="atc_register_form" ng-controller="atc_register_form">
      {% csrf_token %}

      <div class="modal-content">
        <div class="modal-header">
          <button class="close" data-dismiss="modal" type="button">
            &times;
          </button>
          <h4 class="modal-title">atc registration form</h4>
        </div>
        <div class="modal-body">

          <!-- Form for registering new ATC. -->
          <input class="form-control" id="atc-code-input" name="atc_code_input"
            type="text"
            param="{% url 'airport_management:check_air_traffic_controller_code_existence' %}"
            placeholder="code" ng-change="check_atc_code_existence()"
            ng-model="atc_code_input" required/>
          <input class="form-control" name="atc_first_name_input" type="text"
            placeholder="first name"
            ng-change="disable_atc_register_button_callback()"
            ng-model="atc_first_name_input" required/>
          <input class="form-control" name="atc_last_name_input" type="text"
            placeholder="last name"
            ng-change="disable_atc_register_button_callback()"
            ng-model="atc_last_name_input" required/>

        </div>
        <div class="modal-footer">

          <!-- Reset form and register buttons. -->
          <input class="btn btn-default" id="atc-reset-button" type="button"
            value="reset" ng-click="reset_values()" />
          <input class="btn btn-success" id="atc-submit-button" type="submit"
            value="register" ng-disabled="disable_atc_register_button"
          />

        </div>
      </div>

    </form>

  </div>
</div>

<!-- Modal page for ATC list. -->
<div class="fade modal" id="atc-list-modal" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content. -->
    <div class="modal-content">
      <div class="modal-header">
        <button class="close" data-dismiss="modal" type="button">
          &times;
        </button>
        <h4 class="modal-title">atc list</h4>
      </div>
      <div class="modal-body">
        <table class="table table-condensed" id="atc-list-table">
          <thead>
            <tr>
              <!--
              PENDING: I could make more extensive table for the ATCs but it
              will take more time to implement some kind like passive drop down
              menu.
              -->
              <th>atc code</th>
              <th>first name</th>
              <th>last name</th>
            </tr>
          </thead>
          <tbody>

            {% for atc in atcs %}
              <tr>
                <td>{{ atc.code }}</td>
                <td>{{ atc.first_name }}</td>
                <td>{{ atc.last_name }}</td>
              </tr>
            {% endfor %}

          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>

<!-- Modal page if user inserted unmatched password. -->
<div class="fade modal" id="wrong-password-modal" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button class="close" data-dismiss="modal" type="button">&times;</button>
        <h4 class="modal-title">error!</h4>
      </div>
      <div class="modal-body">
        wrong username and password combination
      </div>
    </div>

  </div>
</div>