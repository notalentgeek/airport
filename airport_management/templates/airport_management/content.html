{% load djng_tags %}
{% load static %}
<div id="main-content">
  <!-- If an airport manager is logged in, show the flight management panel. -->
  {% if user.is_authenticated and not user.is_superuser %}
    <div id="flight-management-panel" ng-controller="flight_management_panel">
      <div id="flight-management-panel-content">
        {% include "airport_management/flight_management_panel.html" with flight_management_panel_initial_doms=flight_management_panel_initial_doms flight_management_panel_initial_status_dom=flight_management_panel_initial_status_dom  %}
      </div>
      <div id="flight-management-button-container">
        {% angularjs %}
          <!-- Three buttons. -->
          <button class="btn btn-block flight-management-button {{ control_button.bootstrap_color }}"
            ng-bind-html="control_button.text" ng-click="control_button.ng_click()"
            ng-repeat="control_button in control_buttons">
          </button>
        {% endangularjs %}
      </div>
    </div>
    <hr class="line-separator" />
  {% endif %}
  <!--
  Invisible DOM to store GET url to get new flight table when clicking on
  pagination button.
  -->
  <div id="pagination-request-flight-table"
    param="{% url 'airport_management:pagination_request_flight_table' %}">
  </div>
  <!--
  Invisible DOM to store GET url to get flight document when a row is clicked.
  -->
  <div id="table-request-flight"
    param="{% url 'airport_management:table_request_flight' %}">
  </div>
  <!-- Set of tables (table title, table, and table pagination). -->
  <div id="arrivaldeparture-table-set-container"
    ng-controller="arrivaldeparture_table">
    <!-- Create two tables, arrival flight table and departure flight table. -->
    {% for table_properties in tables_properties %}
      <div class="arrivaldeparture-table"
        id="{{ table_properties.table_set_container_id }}">
        <!-- Table title. -->
        <div>
          <h1 class="arrivaldeparture-table-title">
            {{ table_properties.table_title }}
          </h1>
        </div>
        <!-- Table. -->
        <div class="arrivaldeparture-table-content-container">
          <div>
            <!-- Error table. -->
            <div id="{{ table_properties.table_error_id }}">
              <i>server problem</i>
            </div>
            <!-- Requesting table. -->
            <div id="{{ table_properties.table_requesting_id }}">
              <i>requesting new table</i>
            </div>
            <!-- Main table. -->
            <table class="table table-condensed table-hover"
              id="{{ table_properties.table_id }}">
              {% include "airport_management/paginated_table.html" with flight_objects=table_properties.flight_objects %}
            </table>
          </div>
        </div>
        <!-- Table pagination. -->
        <div class="arrivaldeparture-table-pagination-container">
          <ul class="pagination"
            id ="{{ table_properties.table_pagination_id }}"
            param="{{ table_properties.number_of_pages }}">
          </ul>
        </div>
      </div>
    {% endfor %}
  </div>
</div>
<!-- Modal page for inputting ATC to a flight. -->
<div class="modal fade" id="set-flight-atc-form-modal" role="dialog">
  <div class="modal-dialog">
    <form action="{% url 'airport_management:set_flight_atc_form' %}"
      id="set-flight-atc-form" method="POST"
      ng-controller="set_flight_atc_form">
      {% csrf_token %}
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">
            &times;
          </button>
          <h4 class="modal-title">set atc</h4>
        </div>
        <div class="modal-body">
          <input id="set-flight-atc-form-flight-online-atc" name="atcs" value="{{ flight_management_panel_initial_flight_online_atc }}" style="display: none;" />
          <input id="set-flight-atc-form-arrivaldeparture"
            name="arrivaldeparture" type="text"
            value="{{ flight_management_panel_initial_arrivaldeparture }}" />
          <input id="set-flight-atc-form-flight-id"
            name="flight_id" type="text"
            value="{{ flight_management_panel_initial_flight_id }}" />
          <table>
            {% for atc in atcs %}
              <tr>
                <td class="td-with-checkbox">
                  <input class="atc-checklist" id="atc-checklist-{{ atc.id }}" type="checkbox" name="atc" value="{{ atc.id }}"
                    ng-model="atc_checklists[{{ forloop.counter0 }}]" />
                </td>
                <td class="td-without-checkbox">
                  <div>{{ atc.code }}</div>
                </td>
              </tr>
            {% endfor %}
          </table>
        </div>
        <div class="modal-footer">
          <input class="btn btn-block btn-default" type="button" value="reset"
            ng-click="reset_atc_checklists()">
          <input class="btn btn-block btn-success" type="submit" value="set">
        </div>
      </form>
    </div>
  </div>
</div>


<style>
  #set-flight-atc-form-arrivaldeparture,
  #set-flight-atc-form-flight-id {
    display: none;
  }
  #set-flight-atc-form-modal .modal-body {
    max-height: 50vh;
    overflow-x: hidden;
    overflor-y: auto;
  }
  #set-flight-atc-form-modal .modal-footer {
    display: flex;
    flex-direction: row;
  }
  #set-flight-atc-form-modal .modal-footer>input {
    flex: 1;
    margin: 0;
  }
  #set-flight-atc-form-modal .td-with-checkbox {
    padding: 2.5px;
  }
  #set-flight-atc-form-modal .td-with-checkbox>input {
    height: 30px;
    width: 30px;
  }
  #set-flight-atc-form-modal .td-without-checkbox {
    padding: 2.5px;
    position: absolute;
    width: 80%;
  }
  #set-flight-atc-form-modal .td-without-checkbox>div {
    max-width: 100%;
    overflow: hidden;
    padding: 7.5px;
    position: relative;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
</style>